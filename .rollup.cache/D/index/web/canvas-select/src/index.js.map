{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import Rect from './shape/Rect';\r\nimport Polygon from './shape/Polygon';\r\nimport Dot from './shape/Dot';\r\nimport EventBus from './EventBus';\r\nimport Line from './shape/Line';\r\nimport Circle from './shape/Circle';\r\nimport { isNested } from \"./tools\";\r\n\r\nexport type Point = [number, number];\r\nexport type AllShape = Rect | Polygon | Dot | Line | Circle;\r\nenum Shape {\r\n    None,\r\n    Rect,\r\n    Polygon,\r\n    Dot,\r\n    Line,\r\n    Circle\r\n}\r\n\r\nexport default class CanvasSelect extends EventBus {\r\n    /** 只读模式，画布不允许任何交互 */\r\n    lock: boolean = false;\r\n    /** 只读模式，仅支持查看 */\r\n    readonly: boolean = false;\r\n    /** 最小矩形宽度 */\r\n    MIN_WIDTH = 10;\r\n    /** 最小矩形高度 */\r\n    MIN_HEIGHT = 10;\r\n    /** 最小圆形半径 */\r\n    MIN_RADIUS = 5;\r\n    /** 边线颜色 */\r\n    strokeStyle = '#0f0';\r\n    /** 填充颜色 */\r\n    fillStyle = 'rgba(0, 0, 255,0.1)';\r\n    /** 边线宽度 */\r\n    lineWidth = 1;\r\n    /** 当前选中的标注边线颜色 */\r\n    activeStrokeStyle = '#f00';\r\n    /** 当前选中的标注填充颜色 */\r\n    activeFillStyle = 'rgba(255, 0, 0,0.1)';\r\n    /** 控制点边线颜色 */\r\n    ctrlStrokeStyle = '#000';\r\n    /** 控制点填充颜色 */\r\n    ctrlFillStyle = '#fff';\r\n    /** 控制点半径 */\r\n    ctrlRadius = 3;\r\n    /** 是否隐藏标签 */\r\n    hideLabel = false;\r\n    /** 标签背景填充颜色 */\r\n    labelFillStyle = '#fff';\r\n    /** 标签字体 */\r\n    labelFont = '10px sans-serif';\r\n    /** 标签文字颜色 */\r\n    textFillStyle = '#000';\r\n    /** 标签字符最大长度，超出使用省略号 */\r\n    labelMaxLen = 10;\r\n    /** 画布宽度 */\r\n    WIDTH = 0;\r\n    /** 画布高度 */\r\n    HEIGHT = 0;\r\n\r\n    canvas: HTMLCanvasElement | any;\r\n\r\n    ctx: CanvasRenderingContext2D | any;\r\n    /** 所有标注数据 */\r\n    dataset: AllShape[] = [];\r\n\r\n    offScreen: HTMLCanvasElement | any;\r\n\r\n    offScreenCtx: CanvasRenderingContext2D | any;\r\n    /** 记录锚点距离 */\r\n    remmber: number[][] = [];\r\n    /** 记录鼠标位置 */\r\n    mouse: Point = [0, 0];\r\n    /** 记录背景图鼠标位移 */\r\n    remmberOrigin: number[] = [0, 0];\r\n    /** 0 不创建，1 矩形，2 多边形，3 点，4 折线，5 圆 */\r\n    createType: Shape = Shape.None; //\r\n    /** 控制点索引 */\r\n    ctrlIndex = -1;\r\n    /** 背景图片 */\r\n    image: HTMLImageElement = new Image();\r\n    /** 图片原始宽度 */\r\n    IMAGE_ORIGIN_WIDTH: number = 0;\r\n    /** 图片缩放宽度 */\r\n    IMAGE_WIDTH = 0;\r\n    /** 图片原始高度 */\r\n    IMAGE_ORIGIN_HEIGHT = 0;\r\n    /** 图片缩放高度 */\r\n    IMAGE_HEIGHT = 0;\r\n    /** 原点x */\r\n    originX = 0;\r\n    /** 原点y */\r\n    originY = 0;\r\n    /** 缩放步长 */\r\n    scaleStep = 0;\r\n    /** 滚动缩放 */\r\n    scrollZoom = true;\r\n\r\n    private timer: any;\r\n    /** 最小touch双击时间 */\r\n    dblTouch = 300;\r\n    /** 记录touch双击开始时间 */\r\n    dblTouchStore = 0; //\r\n    /** 这个选项可以帮助浏览器进行内部优化 */\r\n    alpha = true;\r\n    /** 专注模式 */\r\n    focusMode = false;\r\n    /** 记录当前事件 */\r\n    public evt: MouseEvent | TouchEvent | KeyboardEvent | null = null;\r\n    /** 触控缩放时记录上一次两点距离 */\r\n    scaleTouchStore = 0;\r\n    /** 当前是否为双指触控 */\r\n    isTouch2 = false;\r\n    isMobile = navigator.userAgent.includes('Mobile');\r\n    /** 向上展示label */\r\n    labelUp = false;\r\n    private ctrlKey = false;\r\n    /**\r\n     * @param el Valid CSS selector string, or DOM\r\n     * @param src image src\r\n     */\r\n    constructor(el: HTMLCanvasElement | string, src?: string) {\r\n        super();\r\n        this.handleLoad = this.handleLoad.bind(this);\r\n        this.handleContextmenu = this.handleContextmenu.bind(this);\r\n        this.handleMousewheel = this.handleMousewheel.bind(this);\r\n        this.handleMouseDown = this.handleMouseDown.bind(this);\r\n        this.handleMouseMove = this.handleMouseMove.bind(this);\r\n        this.handleMouseUp = this.handleMouseUp.bind(this);\r\n        this.handleDblclick = this.handleDblclick.bind(this);\r\n        this.handleKeyup = this.handleKeyup.bind(this);\r\n        this.handleKeydown = this.handleKeydown.bind(this);\r\n        const container = typeof el === 'string' ? document.querySelector(el) : el;\r\n        if (container instanceof HTMLCanvasElement) {\r\n            this.canvas = container;\r\n            this.offScreen = document.createElement('canvas');\r\n            this.initSetting();\r\n            this.initEvents();\r\n            src && this.setImage(src);\r\n        } else {\r\n            console.warn('HTMLCanvasElement is required!');\r\n        }\r\n    }\r\n\r\n    /** 当前当前选中的标注 */\r\n    get activeShape() {\r\n        return this.dataset.find(x => x.active) || {} as any;\r\n    }\r\n\r\n    /** 当前缩放比例 */\r\n    get scale() {\r\n        if (this.IMAGE_ORIGIN_WIDTH && this.IMAGE_WIDTH) {\r\n            return this.IMAGE_WIDTH / this.IMAGE_ORIGIN_WIDTH;\r\n        }\r\n        return 1;\r\n    }\r\n\r\n    /** 图片最小边尺寸 */\r\n    get imageMin() {\r\n        return Math.min(this.IMAGE_WIDTH, this.IMAGE_HEIGHT);\r\n    }\r\n\r\n    /** 图片原始最大边尺寸 */\r\n    get imageOriginMax() {\r\n        return Math.max(this.IMAGE_ORIGIN_WIDTH, this.IMAGE_ORIGIN_HEIGHT);\r\n    }\r\n\r\n    /** 合成事件 */\r\n    private mergeEvent(e: TouchEvent | MouseEvent) {\r\n        let mouseX = 0;\r\n        let mouseY = 0;\r\n        let mouseCX = 0;\r\n        let mouseCY = 0;\r\n        if (this.isMobile) {\r\n            const { clientX, clientY } = (e as TouchEvent).touches[0];\r\n            const target = e.target as HTMLCanvasElement;\r\n            const { left, top } = target.getBoundingClientRect();\r\n            mouseX = Math.round(clientX - left);\r\n            mouseY = Math.round(clientY - top);\r\n            if ((e as TouchEvent).touches.length === 2) {\r\n                const { clientX: clientX1 = 0, clientY: clientY1 = 0 } = (e as TouchEvent).touches[1] || {};\r\n                mouseCX = Math.round(Math.abs((clientX1 - clientX) / 2 + clientX) - left);\r\n                mouseCY = Math.round(Math.abs((clientY1 - clientY) / 2 + clientY) - top);\r\n            }\r\n        } else {\r\n            mouseX = (e as MouseEvent).offsetX;\r\n            mouseY = (e as MouseEvent).offsetY;\r\n        }\r\n        return { ...e, mouseX, mouseY, mouseCX, mouseCY };\r\n    }\r\n\r\n    private handleLoad() {\r\n        this.emit('load', this.image.src);\r\n        this.IMAGE_ORIGIN_WIDTH = this.IMAGE_WIDTH = this.image.width;\r\n        this.IMAGE_ORIGIN_HEIGHT = this.IMAGE_HEIGHT = this.image.height;\r\n        this.fitZoom();\r\n    }\r\n\r\n    private handleContextmenu(e: MouseEvent) {\r\n        e.preventDefault();\r\n        this.evt = e;\r\n        if (this.lock) return;\r\n    }\r\n\r\n    private handleMousewheel(e: WheelEvent) {\r\n        e.stopPropagation();\r\n        this.evt = e;\r\n        if (this.lock || !this.scrollZoom) return;\r\n        const { mouseX, mouseY } = this.mergeEvent(e);\r\n        this.mouse = [mouseX, mouseY];\r\n        this.setScale(e.deltaY < 0, true);\r\n    }\r\n\r\n    private handleMouseDown(e: MouseEvent | TouchEvent) {\r\n        e.stopPropagation();\r\n        this.evt = e;\r\n        if (this.lock) return;\r\n        const { mouseX, mouseY, mouseCX, mouseCY } = this.mergeEvent(e);\r\n        const offsetX = Math.round(mouseX / this.scale);\r\n        const offsetY = Math.round(mouseY / this.scale);\r\n        this.mouse = this.isMobile && (e as TouchEvent).touches.length === 2 ? [mouseCX, mouseCY] : [mouseX, mouseY];\r\n        this.remmberOrigin = [mouseX - this.originX, mouseY - this.originY];\r\n        if ((!this.isMobile && (e as MouseEvent).buttons === 1) || (this.isMobile && (e as TouchEvent).touches.length === 1)) { // 鼠标左键\r\n            const ctrls = this.activeShape.ctrlsData || [];\r\n            this.ctrlIndex = ctrls.findIndex((coor: Point) => this.isPointInCircle(this.mouse, coor, this.ctrlRadius));\r\n            if (this.ctrlIndex > -1 && !this.readonly) { // 点击到控制点\r\n                const [x0, y0] = ctrls[this.ctrlIndex];\r\n                if (this.activeShape.type === Shape.Polygon && this.activeShape.coor.length > 2 && this.ctrlIndex === 0) {\r\n                    this.handleDblclick(e)\r\n                }\r\n                this.remmber = [[offsetX - x0, offsetY - y0]];\r\n            } else if (this.isInBackground(e)) {\r\n                if (this.activeShape.creating && !this.readonly) { // 创建中\r\n                    if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type)) {\r\n                        const [x, y] = this.activeShape.coor[this.activeShape.coor.length - 1];\r\n                        if (x !== offsetX && y !== offsetY) {\r\n                            const nx = Math.round(offsetX - this.originX / this.scale);\r\n                            const ny = Math.round(offsetY - this.originY / this.scale);\r\n                            this.activeShape.coor.push([nx, ny]);\r\n                        }\r\n                    }\r\n                } else if (this.createType !== Shape.None && !this.readonly && !this.ctrlKey) { // 开始创建\r\n                    let newShape: any;\r\n                    const nx = Math.round(offsetX - this.originX / this.scale);\r\n                    const ny = Math.round(offsetY - this.originY / this.scale);\r\n                    const curPoint: Point = [nx, ny];\r\n                    switch (this.createType) {\r\n                        case Shape.Rect:\r\n                            newShape = new Rect({ coor: [curPoint, curPoint] }, this.dataset.length);\r\n                            newShape.creating = true;\r\n                            break;\r\n                        case Shape.Polygon:\r\n                            newShape = new Polygon({ coor: [curPoint] }, this.dataset.length);\r\n                            newShape.creating = true;\r\n                            break;\r\n                        case Shape.Dot:\r\n                            newShape = new Dot({ coor: curPoint }, this.dataset.length);\r\n                            this.emit('add', newShape);\r\n                            break;\r\n                        case Shape.Line:\r\n                            newShape = new Line({ coor: [curPoint] }, this.dataset.length);\r\n                            newShape.creating = true;\r\n                            break;\r\n                        case Shape.Circle:\r\n                            newShape = new Circle({ coor: curPoint }, this.dataset.length);\r\n                            newShape.creating = true;\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                    this.dataset.forEach((sp) => { sp.active = false; });\r\n                    newShape.active = true;\r\n                    this.dataset.push(newShape);\r\n                } else {\r\n                    // 是否点击到形状\r\n                    const [hitShapeIndex, hitShape] = this.hitOnShape(this.mouse);\r\n                    if (hitShapeIndex > -1) {\r\n                        hitShape.dragging = true;\r\n                        this.dataset.forEach((item, i) => item.active = i === hitShapeIndex);\r\n                        this.dataset.splice(hitShapeIndex, 1);\r\n                        this.dataset.push(hitShape);\r\n                        if (!this.readonly) {\r\n                            this.remmber = [];\r\n                            if ([Shape.Dot, Shape.Circle].includes(hitShape.type)) {\r\n                                const [x, y] = hitShape.coor;\r\n                                this.remmber = [[offsetX - x, offsetY - y]];\r\n                            } else {\r\n                                hitShape.coor.forEach((pt: any) => {\r\n                                    this.remmber.push([offsetX - pt[0], offsetY - pt[1]]);\r\n                                });\r\n                            }\r\n                        }\r\n                        this.emit('select', hitShape);\r\n                    } else {\r\n                        this.activeShape.active = false;\r\n                        this.dataset.sort((a, b) => a.index - b.index);\r\n                        this.emit('select', null);\r\n                    }\r\n                }\r\n                this.update();\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleMouseMove(e: MouseEvent | TouchEvent) {\r\n        e.stopPropagation();\r\n        this.evt = e;\r\n        if (this.lock) return;\r\n        const { mouseX, mouseY, mouseCX, mouseCY } = this.mergeEvent(e);\r\n        const offsetX = Math.round(mouseX / this.scale);\r\n        const offsetY = Math.round(mouseY / this.scale);\r\n        this.mouse = this.isMobile && (e as TouchEvent).touches.length === 2 ? [mouseCX, mouseCY] : [mouseX, mouseY];\r\n        if (((!this.isMobile && (e as MouseEvent).buttons === 1) || (this.isMobile && (e as TouchEvent).touches.length === 1)) && this.activeShape.type) {\r\n            if (this.ctrlIndex > -1 && this.remmber.length && (this.isInBackground(e) || this.activeShape.type === Shape.Circle)) {\r\n                const [[x, y]] = this.remmber;\r\n                // resize矩形\r\n                if (this.activeShape.type === Shape.Rect) {\r\n                    const [[x0, y0], [x1, y1]] = this.activeShape.coor;\r\n                    let coor: Point[] = [];\r\n                    switch (this.ctrlIndex) {\r\n                        case 0:\r\n                            coor = [[offsetX - x, offsetY - y], [x1, y1]];\r\n                            break;\r\n                        case 1:\r\n                            coor = [[x0, offsetY - y], [x1, y1]];\r\n                            break;\r\n                        case 2:\r\n                            coor = [[x0, offsetY - y], [offsetX - x, y1]];\r\n                            break;\r\n                        case 3:\r\n                            coor = [[x0, y0], [offsetX - x, y1]];\r\n                            break;\r\n                        case 4:\r\n                            coor = [[x0, y0], [offsetX - x, offsetY - y]];\r\n                            break;\r\n                        case 5:\r\n                            coor = [[x0, y0], [x1, offsetY - y]];\r\n                            break;\r\n                        case 6:\r\n                            coor = [[offsetX - x, y0], [x1, offsetY - y]];\r\n                            break;\r\n                        case 7:\r\n                            coor = [[offsetX - x, y0], [x1, y1]];\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                    let [[a0, b0], [a1, b1]] = coor;\r\n                    if (\r\n                        a0 < 0 ||\r\n                        a1 < 0 ||\r\n                        b0 < 0 ||\r\n                        b1 < 0 ||\r\n                        a1 > this.IMAGE_ORIGIN_WIDTH ||\r\n                        b1 > this.IMAGE_ORIGIN_HEIGHT\r\n                    ) {\r\n                        // 偶然触发 超出边界处理\r\n                        a0 < 0 && (a0 = 0);\r\n                        a1 < 0 && (a1 = 0);\r\n                        b0 < 0 && (b0 = 0);\r\n                        b1 < 0 && (b1 = 0);\r\n                        if (a1 > this.IMAGE_ORIGIN_WIDTH) {\r\n                            a1 = this.IMAGE_ORIGIN_WIDTH;\r\n                        }\r\n                        if (b1 > this.IMAGE_ORIGIN_HEIGHT) {\r\n                            b1 = this.IMAGE_ORIGIN_HEIGHT;\r\n                        }\r\n                    }\r\n\r\n                    if (a1 - a0 >= this.MIN_WIDTH && b1 - b0 >= this.MIN_HEIGHT) {\r\n                        this.activeShape.coor = [[a0, b0], [a1, b1]];\r\n                    } else {\r\n                        this.emit('warn', `Width cannot be less than ${this.MIN_WIDTH},Height cannot be less than${this.MIN_HEIGHT}。`);\r\n                    }\r\n                } else if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type)) {\r\n                    const nx = Math.round(offsetX - this.originX / this.scale);\r\n                    const ny = Math.round(offsetY - this.originY / this.scale);\r\n                    const newPoint = [nx, ny];\r\n                    this.activeShape.coor.splice(this.ctrlIndex, 1, newPoint);\r\n                } else if (this.activeShape.type === Shape.Circle) {\r\n                    const nx = Math.round(offsetX - this.originX / this.scale);\r\n                    const newRadius = nx - this.activeShape.coor[0];\r\n                    if (newRadius >= this.MIN_RADIUS) this.activeShape.radius = newRadius;\r\n                }\r\n            } else if (this.activeShape.dragging && !this.readonly) { // 拖拽\r\n                let coor = [];\r\n                let noLimit = true;\r\n                const w = this.IMAGE_ORIGIN_WIDTH || this.WIDTH;\r\n                const h = this.IMAGE_ORIGIN_HEIGHT || this.HEIGHT;\r\n                if ([Shape.Dot, Shape.Circle].includes(this.activeShape.type)) {\r\n                    const [t1, t2] = this.remmber[0];\r\n                    const x = offsetX - t1;\r\n                    const y = offsetY - t2;\r\n                    if (x < 0 || x > w || y < 0 || y > h) noLimit = false;\r\n                    coor = [x, y];\r\n                } else {\r\n                    for (let i = 0; i < this.activeShape.coor.length; i++) {\r\n                        const tar = this.remmber[i];\r\n                        const x = offsetX - tar[0];\r\n                        const y = offsetY - tar[1];\r\n                        if (x < 0 || x > w || y < 0 || y > h) noLimit = false;\r\n                        coor.push([x, y]);\r\n                    }\r\n                }\r\n                if (noLimit) this.activeShape.coor = coor;\r\n            } else if (this.activeShape.creating && this.isInBackground(e)) {\r\n                const x = Math.round(offsetX - this.originX / this.scale);\r\n                const y = Math.round(offsetY - this.originY / this.scale);\r\n                // 创建矩形\r\n                if (this.activeShape.type === Shape.Rect) {\r\n                    this.activeShape.coor.splice(1, 1, [x, y]);\r\n                } else if (this.activeShape.type === Shape.Circle) {\r\n                    const [x0, y0] = this.activeShape.coor;\r\n                    const r = Math.sqrt((x0 - x) ** 2 + (y0 - y) ** 2);\r\n                    this.activeShape.radius = r;\r\n                }\r\n            }\r\n            this.update();\r\n        } else if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type) && this.activeShape.creating) {\r\n            // 多边形添加点\r\n            this.update();\r\n        } else if ((!this.isMobile && (e as MouseEvent).buttons === 2 && (e as MouseEvent).which === 3) || (this.isMobile && (e as TouchEvent).touches.length === 1 && !this.isTouch2)) {\r\n            // 拖动背景\r\n            this.originX = Math.round(mouseX - this.remmberOrigin[0]);\r\n            this.originY = Math.round(mouseY - this.remmberOrigin[1]);\r\n            this.update();\r\n        } else if (this.isMobile && (e as TouchEvent).touches.length === 2) {\r\n            this.isTouch2 = true;\r\n            const touch0 = (e as TouchEvent).touches[0];\r\n            const touch1 = (e as TouchEvent).touches[1];\r\n            const cur = this.scaleTouchStore;\r\n            this.scaleTouchStore = Math.abs((touch1.clientX - touch0.clientX) * (touch1.clientY - touch0.clientY));\r\n            this.setScale(this.scaleTouchStore > cur, true);\r\n        }\r\n    }\r\n\r\n    private handleMouseUp(e: MouseEvent | TouchEvent) {\r\n        e.stopPropagation();\r\n        this.evt = e;\r\n        if (this.lock) return;\r\n        if (this.isMobile) {\r\n            if ((e as TouchEvent).touches.length === 0) {\r\n                this.isTouch2 = false;\r\n            }\r\n            if ((Date.now() - this.dblTouchStore) < this.dblTouch) {\r\n                this.handleDblclick(e);\r\n                return;\r\n            }\r\n            this.dblTouchStore = Date.now();\r\n        }\r\n        this.remmber = [];\r\n        if (this.activeShape.type !== Shape.None && !this.ctrlKey) {\r\n            this.activeShape.dragging = false;\r\n            if (this.activeShape.creating) {\r\n                if (this.activeShape.type === Shape.Rect) {\r\n                    const [[x0, y0], [x1, y1]] = this.activeShape.coor;\r\n                    if (Math.abs(x0 - x1) < this.MIN_WIDTH || Math.abs(y0 - y1) < this.MIN_HEIGHT) {\r\n                        this.dataset.pop();\r\n                        this.emit('warn', `Width cannot be less than ${this.MIN_WIDTH},Height cannot be less than ${this.MIN_HEIGHT}`);\r\n                    } else {\r\n                        this.activeShape.coor = [[Math.min(x0, x1), Math.min(y0, y1)], [Math.max(x0, x1), Math.max(y0, y1)]];\r\n                        this.activeShape.creating = false;\r\n                        this.emit('add', this.activeShape);\r\n                    }\r\n                } else if (this.activeShape.type === Shape.Circle) {\r\n                    if (this.activeShape.radius < this.MIN_RADIUS) {\r\n                        this.dataset.pop();\r\n                        this.emit('warn', `Radius cannot be less than ${this.MIN_WIDTH}`);\r\n                    } else {\r\n                        this.activeShape.creating = false;\r\n                        this.emit('add', this.activeShape);\r\n                    }\r\n                }\r\n                this.update();\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleDblclick(e: MouseEvent | TouchEvent) {\r\n        e.stopPropagation();\r\n        this.evt = e;\r\n        if (this.lock) return;\r\n        if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type)) {\r\n            const canPolygon = this.activeShape.type === Shape.Polygon && this.activeShape.coor.length > 2\r\n            const canLine = this.activeShape.type === Shape.Line && this.activeShape.coor.length > 1\r\n            if (canPolygon || canLine) {\r\n                this.emit('add', this.activeShape);\r\n                this.activeShape.creating = false;\r\n                this.update();\r\n            }\r\n        }\r\n    }\r\n    private handleKeydown(e: KeyboardEvent) {\r\n        if (e.key === 'Control') {\r\n            this.ctrlKey = true;\r\n        }\r\n    }\r\n\r\n    private handleKeyup(e: KeyboardEvent) {\r\n        if (e.key === 'Control') {\r\n            this.ctrlKey = false;\r\n        }\r\n        this.evt = e;\r\n        if (this.lock || this.readonly) return;\r\n        if (this.activeShape.type) {\r\n            if ([Shape.Polygon, Shape.Line].includes(this.activeShape.type) && e.key === 'Escape') {\r\n                if (this.activeShape.coor.length > 1 && this.activeShape.creating) {\r\n                    this.activeShape.coor.pop();\r\n                } else {\r\n                    this.deleteByIndex(this.activeShape.index);\r\n                }\r\n                this.update();\r\n            } else if (e.key === 'Delete') {\r\n                this.deleteByIndex(this.activeShape.index);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** 初始化配置 */\r\n    initSetting() {\r\n        const dpr = window.devicePixelRatio || 1;\r\n        this.canvas.style.userSelect = 'none';\r\n        this.ctx = this.ctx || this.canvas.getContext('2d', { alpha: this.alpha });\r\n        this.WIDTH = Math.round(this.canvas.clientWidth);\r\n        this.HEIGHT = Math.round(this.canvas.clientHeight);\r\n        this.canvas.width = this.WIDTH * dpr;\r\n        this.canvas.height = this.HEIGHT * dpr;\r\n        this.canvas.style.width = this.WIDTH + 'px';\r\n        this.canvas.style.height = this.HEIGHT + 'px';\r\n        this.offScreen.width = this.WIDTH;\r\n        this.offScreen.height = this.HEIGHT;\r\n        this.offScreenCtx = this.offScreenCtx || this.offScreen.getContext('2d', { willReadFrequently: true });\r\n        this.ctx.scale(dpr, dpr);\r\n    }\r\n\r\n    /** 初始化事件 */\r\n    initEvents() {\r\n        this.image.addEventListener('load', this.handleLoad);\r\n        this.canvas.addEventListener('touchstart', this.handleMouseDown);\r\n        this.canvas.addEventListener('touchmove', this.handleMouseMove);\r\n        this.canvas.addEventListener('touchend', this.handleMouseUp);\r\n        this.canvas.addEventListener('contextmenu', this.handleContextmenu);\r\n        this.canvas.addEventListener('mousewheel', this.handleMousewheel);\r\n        this.canvas.addEventListener('mousedown', this.handleMouseDown);\r\n        this.canvas.addEventListener('mousemove', this.handleMouseMove);\r\n        this.canvas.addEventListener('mouseup', this.handleMouseUp);\r\n        this.canvas.addEventListener('dblclick', this.handleDblclick);\r\n        document.body.addEventListener('keydown', this.handleKeydown, true);\r\n        document.body.addEventListener('keyup', this.handleKeyup, true);\r\n    }\r\n\r\n    /**\r\n     * 添加/切换图片\r\n     * @param url 图片链接\r\n     */\r\n    setImage(url: string) {\r\n        this.image.src = url;\r\n    }\r\n\r\n    /**\r\n     * 设置数据\r\n     * @param data Array\r\n     */\r\n    setData(data: AllShape[]) {\r\n        setTimeout(() => {\r\n            const initdata: AllShape[] = [];\r\n            data.forEach((item, index) => {\r\n                if (Object.prototype.toString.call(item).includes('Object')) {\r\n                    let shape: AllShape;\r\n                    switch (item.type) {\r\n                        case Shape.Rect:\r\n                            shape = new Rect(item, index);\r\n                            break;\r\n                        case Shape.Polygon:\r\n                            shape = new Polygon(item, index);\r\n                            break;\r\n                        case Shape.Dot:\r\n                            shape = new Dot(item, index);\r\n                            break;\r\n                        case Shape.Line:\r\n                            shape = new Line(item, index);\r\n                            break;\r\n                        case Shape.Circle:\r\n                            shape = new Circle(item, index);\r\n                            break;\r\n                        default:\r\n                            shape = new Rect(item, index);\r\n                            console.warn('Invalid shape', item);\r\n                            break;\r\n                    }\r\n                    [Shape.Rect, Shape.Polygon, Shape.Dot, Shape.Line, Shape.Circle].includes(item.type) && initdata.push(shape);\r\n                } else {\r\n                    console.warn('Shape must be an enumerable Object.', item);\r\n                }\r\n            });\r\n            this.dataset = initdata;\r\n            this.update();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 判断是否在标注实例上\r\n     * @param mousePoint 点击位置\r\n     * @returns\r\n     */\r\n    hitOnShape(mousePoint: Point): [number, AllShape] {\r\n        let hitShapeIndex = -1;\r\n        let hitShape: AllShape | any;\r\n        for (let i = this.dataset.length - 1; i > -1; i--) {\r\n            const shape = this.dataset[i];\r\n            if (\r\n                (shape.type === Shape.Dot && this.isPointInCircle(mousePoint, shape.coor as Point, this.ctrlRadius)) ||\r\n                (shape.type === Shape.Circle && this.isPointInCircle(mousePoint, shape.coor as Point, (shape as Circle).radius * this.scale)) ||\r\n                (shape.type === Shape.Rect && this.isPointInRect(mousePoint, (shape as Rect).coor)) ||\r\n                (shape.type === Shape.Polygon && this.isPointInPolygon(mousePoint, (shape as Polygon).coor)) ||\r\n                (shape.type === Shape.Line && this.isPointInLine(mousePoint, (shape as Line).coor))\r\n            ) {\r\n                if (this.focusMode && !shape.active) continue;\r\n                hitShapeIndex = i;\r\n                hitShape = shape;\r\n                break;\r\n            }\r\n        }\r\n        return [hitShapeIndex, hitShape];\r\n    }\r\n\r\n    /**\r\n     * 判断鼠标是否在背景图内部\r\n     * @param e MouseEvent\r\n     * @returns 布尔值\r\n     */\r\n    isInBackground(e: MouseEvent | TouchEvent): boolean {\r\n        const { mouseX, mouseY } = this.mergeEvent(e);\r\n        return mouseX >= this.originX &&\r\n            mouseY >= this.originY &&\r\n            mouseX <= this.originX + this.IMAGE_ORIGIN_WIDTH * this.scale &&\r\n            mouseY <= this.originY + this.IMAGE_ORIGIN_HEIGHT * this.scale;\r\n    }\r\n\r\n    /**\r\n     * 判断是否在矩形内\r\n     * @param point 坐标\r\n     * @param coor 区域坐标\r\n     * @returns 布尔值\r\n     */\r\n    isPointInRect(point: Point, coor: Point[]): boolean {\r\n        const [x, y] = point;\r\n        const [[x0, y0], [x1, y1]] = coor.map((a) => a.map((b) => b * this.scale));\r\n        return x0 + this.originX <= x &&\r\n            x <= x1 + this.originX &&\r\n            y0 + this.originY <= y &&\r\n            y <= y1 + this.originY;\r\n    }\r\n\r\n    /**\r\n     * 判断是否在多边形内\r\n     * @param point 坐标\r\n     * @param coor 区域坐标\r\n     * @returns 布尔值\r\n     */\r\n    isPointInPolygon(point: Point, coor: Point[]): boolean {\r\n        this.offScreenCtx.save();\r\n        this.offScreenCtx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\r\n        this.offScreenCtx.translate(this.originX, this.originY);\r\n        this.offScreenCtx.beginPath();\r\n        coor.forEach((pt, i) => {\r\n            const [x, y] = pt.map((a) => Math.round(a * this.scale));\r\n            if (i === 0) {\r\n                this.offScreenCtx.moveTo(x, y);\r\n            } else {\r\n                this.offScreenCtx.lineTo(x, y);\r\n            }\r\n        });\r\n        this.offScreenCtx.closePath();\r\n        this.offScreenCtx.fill();\r\n        const areaData = this.offScreenCtx.getImageData(0, 0, this.WIDTH, this.HEIGHT);\r\n        const index = (point[1] - 1) * this.WIDTH * 4 + point[0] * 4;\r\n        this.offScreenCtx.restore();\r\n        return areaData.data[index + 3] !== 0;\r\n    }\r\n\r\n    /**\r\n     * 判断是否在圆内\r\n     * @param point 坐标\r\n     * @param center 圆心\r\n     * @param r 半径\r\n     * @param needScale 是否为圆形点击检测\r\n     * @returns 布尔值\r\n     */\r\n    isPointInCircle(point: Point, center: Point, r: number): boolean {\r\n        const [x, y] = point;\r\n        const [x0, y0] = center.map((a) => a * this.scale);\r\n        const distance = Math.sqrt((x0 + this.originX - x) ** 2 + (y0 + this.originY - y) ** 2);\r\n        return distance <= r;\r\n    }\r\n\r\n    /**\r\n     * 判断是否在折线内\r\n     * @param point 坐标\r\n     * @param coor 区域坐标\r\n     * @returns 布尔值\r\n     */\r\n    isPointInLine(point: Point, coor: Point[]): boolean {\r\n        this.offScreenCtx.save();\r\n        this.offScreenCtx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\r\n        this.offScreenCtx.translate(this.originX, this.originY);\r\n        this.offScreenCtx.lineWidth = 5;\r\n        this.offScreenCtx.beginPath();\r\n        coor.forEach((pt, i) => {\r\n            const [x, y] = pt.map((a) => Math.round(a * this.scale));\r\n            if (i === 0) {\r\n                this.offScreenCtx.moveTo(x, y);\r\n            } else {\r\n                this.offScreenCtx.lineTo(x, y);\r\n            }\r\n        });\r\n        this.offScreenCtx.stroke();\r\n        const areaData = this.offScreenCtx.getImageData(0, 0, this.WIDTH, this.HEIGHT);\r\n        const index = (point[1] - 1) * this.WIDTH * 4 + point[0] * 4;\r\n        this.offScreenCtx.restore();\r\n        return areaData.data[index + 3] !== 0;\r\n    }\r\n\r\n    /**\r\n       * 判断是图形是否属于嵌套关系 (目前只支持矩形和多边形)\r\n       * @param shape1 标注实例\r\n       * @param shape2 标注实例\r\n       * @returns 布尔值\r\n       */\r\n    isNested(shape1: Rect | Polygon, shape2: Rect | Polygon): boolean {\r\n        return isNested(shape1, shape2);\r\n    }\r\n\r\n    /**\r\n     * 绘制矩形\r\n     * @param shape 标注实例\r\n     * @returns\r\n     */\r\n    drawRect(shape: Rect) {\r\n        if (shape.coor.length !== 2) return;\r\n        const { strokeStyle, fillStyle, active, creating, coor, lineWidth } = shape;\r\n        const [[x0, y0], [x1, y1]] = coor.map((a: Point) => a.map((b) => Math.round(b * this.scale)));\r\n        this.ctx.save();\r\n        this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n        this.ctx.fillStyle = fillStyle || this.fillStyle;\r\n        this.ctx.strokeStyle = (active || creating) ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\r\n        const w = x1 - x0;\r\n        const h = y1 - y0;\r\n        if (!creating) this.ctx.fillRect(x0, y0, w, h);\r\n        this.ctx.strokeRect(x0, y0, w, h);\r\n        this.ctx.restore();\r\n        this.drawLabel(coor[0], shape);\r\n    }\r\n\r\n    /**\r\n     * 绘制多边形\r\n     * @param shape 标注实例\r\n     */\r\n    drawPolygon(shape: Polygon) {\r\n        const { strokeStyle, fillStyle, active, creating, coor, lineWidth } = shape;\r\n        this.ctx.save();\r\n        this.ctx.lineJoin = 'round';\r\n        this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n        this.ctx.fillStyle = fillStyle || this.fillStyle;\r\n        this.ctx.strokeStyle = (active || creating) ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\r\n        this.ctx.beginPath();\r\n        coor.forEach((el: Point, i) => {\r\n            const [x, y] = el.map((a) => Math.round(a * this.scale));\r\n            if (i === 0) {\r\n                this.ctx.moveTo(x, y);\r\n            } else {\r\n                this.ctx.lineTo(x, y);\r\n            }\r\n        });\r\n        if (creating) {\r\n            const [x, y] = this.mouse || [];\r\n            this.ctx.lineTo(x - this.originX, y - this.originY);\r\n        } else if (coor.length > 2) {\r\n            this.ctx.closePath();\r\n        }\r\n        this.ctx.fill();\r\n        this.ctx.stroke();\r\n        this.ctx.restore();\r\n        this.drawLabel(coor[0], shape);\r\n    }\r\n\r\n    /**\r\n     * 绘制点\r\n     * @param shape 标注实例\r\n     */\r\n    drawDot(shape: Dot) {\r\n        const { strokeStyle, fillStyle, active, coor, lineWidth } = shape;\r\n        const [x, y] = coor.map((a) => a * this.scale);\r\n        this.ctx.save();\r\n        this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n        this.ctx.fillStyle = fillStyle || this.ctrlFillStyle;\r\n        this.ctx.strokeStyle = active ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\r\n        this.ctx.beginPath();\r\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n        this.ctx.fill();\r\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n        this.ctx.stroke();\r\n        this.ctx.restore();\r\n        this.drawLabel(coor as Point, shape);\r\n    }\r\n\r\n    /**\r\n     * 绘制圆\r\n     * @param shape 标注实例\r\n     */\r\n    drawCirle(shape: Circle) {\r\n        const { strokeStyle, fillStyle, active, coor, creating, radius, ctrlsData, lineWidth } = shape;\r\n        const [x, y] = coor.map((a) => a * this.scale);\r\n        this.ctx.save();\r\n        this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n        this.ctx.fillStyle = fillStyle || this.fillStyle;\r\n        this.ctx.strokeStyle = (active || creating) ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\r\n        this.ctx.beginPath();\r\n        this.ctx.arc(x, y, radius * this.scale, 0, 2 * Math.PI, true);\r\n        this.ctx.fill();\r\n        this.ctx.arc(x, y, radius * this.scale, 0, 2 * Math.PI, true);\r\n        this.ctx.stroke();\r\n        this.ctx.restore();\r\n        this.drawLabel(ctrlsData[0] as Point, shape);\r\n    }\r\n\r\n    /**\r\n     * 绘制折线\r\n     * @param shape 标注实例\r\n     */\r\n    drawLine(shape: Line) {\r\n        const { strokeStyle, active, creating, coor, lineWidth } = shape;\r\n        this.ctx.save();\r\n        this.ctx.lineJoin = 'round';\r\n        this.ctx.lineWidth = lineWidth || this.lineWidth;\r\n        this.ctx.strokeStyle = (active || creating) ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\r\n        this.ctx.beginPath();\r\n        coor.forEach((el: Point, i) => {\r\n            const [x, y] = el.map((a) => Math.round(a * this.scale));\r\n            if (i === 0) {\r\n                this.ctx.moveTo(x, y);\r\n            } else {\r\n                this.ctx.lineTo(x, y);\r\n            }\r\n        });\r\n        if (creating) {\r\n            const [x, y] = this.mouse || [];\r\n            this.ctx.lineTo(x - this.originX, y - this.originY);\r\n        }\r\n        this.ctx.stroke();\r\n        this.ctx.restore();\r\n        this.drawLabel(coor[0], shape);\r\n    }\r\n\r\n    /**\r\n     * 绘制控制点\r\n     * @param point 坐标\r\n     */\r\n    drawCtrl(point: Point) {\r\n        const [x, y] = point.map((a) => a * this.scale);\r\n        this.ctx.save();\r\n        this.ctx.beginPath();\r\n        this.ctx.fillStyle = this.ctrlFillStyle;\r\n        this.ctx.strokeStyle = this.ctrlStrokeStyle;\r\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n        this.ctx.fill();\r\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\r\n        this.ctx.stroke();\r\n        this.ctx.restore();\r\n    }\r\n\r\n    /**\r\n     * 绘制控制点列表\r\n     * @param shape 标注实例\r\n     */\r\n    drawCtrlList(shape: Rect | Polygon | Line) {\r\n        shape.ctrlsData.forEach((point, i) => {\r\n            if (shape.type === Shape.Circle) {\r\n                if (i === 1) this.drawCtrl(point);\r\n            } else {\r\n                this.drawCtrl(point);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 绘制label\r\n     * @param point 位置\r\n     * @param label 文本\r\n     */\r\n    drawLabel(point: Point, shape: AllShape) {\r\n        const { label = '', labelFillStyle = '', labelFont = '', textFillStyle = '', hideLabel, labelUp, lineWidth } = shape;\r\n        const isHideLabel = typeof hideLabel === 'boolean' ? hideLabel : this.hideLabel;\r\n        const isLabelUp = typeof labelUp === 'boolean' ? labelUp : this.labelUp;\r\n        const currLineWidth = lineWidth || this.lineWidth;\r\n\r\n        if (label.length && !isHideLabel) {\r\n            this.ctx.font = labelFont || this.labelFont;\r\n            const textPaddingLeft = 4;\r\n            const textPaddingTop = 4;\r\n            const newText = label.length < this.labelMaxLen + 1 ? label : `${label.slice(0, this.labelMaxLen)}...`;\r\n            const text = this.ctx.measureText(newText);\r\n            const font = parseInt(this.ctx.font) - 4;\r\n            const labelWidth = text.width + textPaddingLeft * 2;\r\n            const labelHeight = font + textPaddingTop * 2;\r\n            const [x, y] = point.map((a) => a * this.scale);\r\n            const toleft = (this.IMAGE_ORIGIN_WIDTH - point[0]) < labelWidth / this.scale;\r\n            const toTop = (this.IMAGE_ORIGIN_HEIGHT - point[1]) < labelHeight / this.scale;\r\n            const toTop2 = point[1] > labelHeight / this.scale;\r\n            const isup = isLabelUp ? toTop2 : toTop;\r\n            this.ctx.save();\r\n            this.ctx.fillStyle = labelFillStyle || this.labelFillStyle;\r\n            this.ctx.fillRect(toleft ? (x - text.width - textPaddingLeft - currLineWidth / 2) : (x + currLineWidth / 2), isup ? (y - labelHeight - currLineWidth / 2) : (y + currLineWidth / 2), labelWidth, labelHeight);\r\n            this.ctx.fillStyle = textFillStyle || this.textFillStyle;\r\n            this.ctx.fillText(newText, toleft ? (x - text.width) : (x + textPaddingLeft + currLineWidth / 2), isup ? (y - labelHeight + font + textPaddingTop) : (y + font + textPaddingTop + currLineWidth / 2), 180);\r\n            this.ctx.restore();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新画布\r\n     */\r\n    update() {\r\n        window.cancelAnimationFrame(this.timer);\r\n        this.timer = window.requestAnimationFrame(() => {\r\n            this.ctx.save();\r\n            this.ctx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\r\n            this.ctx.translate(this.originX, this.originY);\r\n            if (this.IMAGE_WIDTH && this.IMAGE_HEIGHT) {\r\n                this.ctx.drawImage(this.image, 0, 0, this.IMAGE_WIDTH, this.IMAGE_HEIGHT);\r\n            }\r\n            const renderList = this.focusMode ? (this.activeShape.type ? [this.activeShape] : []) : this.dataset;\r\n            for (let i = 0; i < renderList.length; i++) {\r\n                const shape = renderList[i];\r\n                if (shape.hide) continue;\r\n                switch (shape.type) {\r\n                    case Shape.Rect:\r\n                        this.drawRect(shape as Rect);\r\n                        break;\r\n                    case Shape.Polygon:\r\n                        this.drawPolygon(shape as Polygon);\r\n                        break;\r\n                    case Shape.Dot:\r\n                        this.drawDot(shape as Dot);\r\n                        break;\r\n                    case Shape.Line:\r\n                        this.drawLine(shape as Line);\r\n                        break;\r\n                    case Shape.Circle:\r\n                        this.drawCirle(shape as Circle);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n            if ([Shape.Rect, Shape.Polygon, Shape.Line, Shape.Circle].includes(this.activeShape.type) && !this.activeShape.hide) {\r\n                this.drawCtrlList(this.activeShape);\r\n            }\r\n            this.ctx.restore();\r\n            this.emit('updated', this.dataset);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 删除指定矩形\r\n     * @param index number\r\n     */\r\n    deleteByIndex(index: number) {\r\n        const num = this.dataset.findIndex((x) => x.index === index);\r\n        if (num > -1) {\r\n            this.emit('delete', this.dataset[num]);\r\n            this.dataset.splice(num, 1);\r\n            this.dataset.forEach((item, i) => { item.index = i; });\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 计算缩放步长\r\n     */\r\n    calcStep(flag = '') {\r\n        if (this.IMAGE_WIDTH < this.WIDTH && this.IMAGE_HEIGHT < this.HEIGHT) {\r\n            if (flag === '' || flag === 'b') {\r\n                this.setScale(true, false, true);\r\n                this.calcStep('b');\r\n            }\r\n        }\r\n        if (this.IMAGE_WIDTH > this.WIDTH || this.IMAGE_HEIGHT > this.HEIGHT) {\r\n            if (flag === '' || flag === 's') {\r\n                this.setScale(false, false, true);\r\n                this.calcStep('s');\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 缩放\r\n     * @param type true放大5%，false缩小5%\r\n     * @param center 缩放中心 center|mouse\r\n     * @param pure 不绘制\r\n     */\r\n    setScale(type: boolean, byMouse = false, pure = false) {\r\n        if (this.lock) return;\r\n        if ((!type && this.imageMin < 20) || (type && this.IMAGE_WIDTH > this.imageOriginMax * 100)) return;\r\n        if (type) { this.scaleStep++; } else { this.scaleStep--; }\r\n        let realToLeft = 0;\r\n        let realToRight = 0;\r\n        const [x, y] = this.mouse || [];\r\n        if (byMouse) {\r\n            realToLeft = (x - this.originX) / this.scale;\r\n            realToRight = (y - this.originY) / this.scale;\r\n        }\r\n        const abs = Math.abs(this.scaleStep);\r\n        const width = this.IMAGE_WIDTH;\r\n        this.IMAGE_WIDTH = Math.round(this.IMAGE_ORIGIN_WIDTH * (this.scaleStep >= 0 ? 1.05 : 0.95) ** abs);\r\n        this.IMAGE_HEIGHT = Math.round(this.IMAGE_ORIGIN_HEIGHT * (this.scaleStep >= 0 ? 1.05 : 0.95) ** abs);\r\n        if (byMouse) {\r\n            this.originX = x - realToLeft * this.scale;\r\n            this.originY = y - realToRight * this.scale;\r\n        } else {\r\n            const scale = this.IMAGE_WIDTH / width;\r\n            this.originX = this.WIDTH / 2 - (this.WIDTH / 2 - this.originX) * scale;\r\n            this.originY = this.HEIGHT / 2 - (this.HEIGHT / 2 - this.originY) * scale;\r\n        }\r\n        if (!pure) {\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 适配背景图\r\n     */\r\n    fitZoom() {\r\n        this.calcStep();\r\n        if (this.IMAGE_HEIGHT / this.IMAGE_WIDTH >= this.HEIGHT / this.WIDTH) {\r\n            this.IMAGE_WIDTH = this.IMAGE_ORIGIN_WIDTH / (this.IMAGE_ORIGIN_HEIGHT / this.HEIGHT);\r\n            this.IMAGE_HEIGHT = this.HEIGHT;\r\n        } else {\r\n            this.IMAGE_WIDTH = this.WIDTH;\r\n            this.IMAGE_HEIGHT = this.IMAGE_ORIGIN_HEIGHT / (this.IMAGE_ORIGIN_WIDTH / this.WIDTH);\r\n        }\r\n        this.originX = (this.WIDTH - this.IMAGE_WIDTH) / 2;\r\n        this.originY = (this.HEIGHT - this.IMAGE_HEIGHT) / 2;\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * 设置专注模式\r\n     * @param type {boolean}\r\n     */\r\n    setFocusMode(type: boolean) {\r\n        this.focusMode = type;\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * 销毁\r\n     */\r\n    destroy() {\r\n        this.image.removeEventListener('load', this.handleLoad);\r\n        this.canvas.removeEventListener('contextmenu', this.handleContextmenu);\r\n        this.canvas.removeEventListener('mousewheel', this.handleMousewheel);\r\n        this.canvas.removeEventListener('mousedown', this.handleMouseDown);\r\n        this.canvas.removeEventListener('touchend', this.handleMouseDown);\r\n        this.canvas.removeEventListener('mousemove', this.handleMouseMove);\r\n        this.canvas.removeEventListener('touchmove', this.handleMouseMove);\r\n        this.canvas.removeEventListener('mouseup', this.handleMouseUp);\r\n        this.canvas.removeEventListener('touchend', this.handleMouseUp);\r\n        this.canvas.removeEventListener('dblclick', this.handleDblclick);\r\n        document.body.removeEventListener('keydown', this.handleKeydown, true);\r\n        document.body.removeEventListener('keyup', this.handleKeyup, true);\r\n        this.canvas.width = this.WIDTH;\r\n        this.canvas.height = this.HEIGHT;\r\n        this.canvas.style.width = null;\r\n        this.canvas.style.height = null;\r\n        this.canvas.style.userSelect = null;\r\n    }\r\n\r\n    /**\r\n     * 重新设置画布大小\r\n     */\r\n    resize() {\r\n        this.canvas.width = null;\r\n        this.canvas.height = null;\r\n        this.canvas.style.width = null;\r\n        this.canvas.style.height = null;\r\n        this.initSetting();\r\n        this.update();\r\n    }\r\n}"]}